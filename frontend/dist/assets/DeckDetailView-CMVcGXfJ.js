import{c as ne,v as me,r as m,o as _e,Q as ve,d as u,e as n,f as s,n as w,w as a,h as i,u as t,i as pe,j as x,t as k,_ as y,a3 as ke,a4 as ye,R as T,S as A,l as W,V as G,W as X,Z as Y,$ as U,g as $,k as ge,a2 as Z,x as L,y as _,A as d}from"./index-BOzyvhxc.js";import{A as he,_ as xe}from"./Textarea-CzgoeUDL.js";import{_ as be,a as ee,b as te,c as we}from"./TabsTrigger-DxXV-QxZ.js";import{_ as $e,a as Ce,b as O,c as K,d as De,e as g}from"./TableHeader-pdgw_vYv.js";import{P as Te,E as se,h as Le,_ as Se,b as Me,c as Ne,d as je,e as Ae,f as Be,g as Ee,i as Ve,j as Fe,k as ze,l as Ie,m as Pe,n as He,o as Ue,p as Oe}from"./AlertDialogTitle-daPoIcB8.js";const ae=ne("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const le=ne("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Ke={class:"max-w-7xl mx-auto space-y-6"},Re={class:"space-y-4"},qe={key:0,class:"flex justify-between items-start"},Ze={class:"text-3xl font-bold tracking-tight text-slate-900 dark:text-slate-50"},Je={class:"text-slate-500 dark:text-slate-400 mt-1 max-w-3xl"},Qe={key:1},We={class:"space-y-4 md:hidden"},Ge={key:0,class:"space-y-4"},Xe={key:1,class:"text-center py-12 text-slate-500 border-2 border-dashed rounded-lg"},Ye={class:"flex justify-between items-start"},et={class:"grid gap-2"},tt={key:0},st={class:"text-xs text-slate-500 uppercase tracking-wider font-semibold mb-1"},at=["innerHTML"],lt={key:1,class:"border-t pt-2 mt-1"},nt={class:"text-xs text-slate-500 uppercase tracking-wider font-semibold mb-1"},ot=["innerHTML"],dt={class:"hidden md:block rounded-md border bg-white dark:bg-slate-900"},it={class:"text-xs text-slate-400 block mb-0.5"},rt=["innerHTML"],ut={class:"text-xs text-slate-400 block mb-0.5"},ct=["innerHTML"],ft={key:0,class:"py-4"},mt={class:"rounded-lg border bg-white dark:bg-slate-900 p-6 space-y-6"},_t={key:0,class:"grid gap-4 max-w-sm"},vt={class:"space-y-2"},pt={class:"space-y-2"},kt={key:1,class:"space-y-4 max-w-sm"},yt={class:"pt-6 border-t space-y-4"},gt={class:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg"},ht={class:"pt-6 border-t"},Tt={__name:"DeckDetailView",setup(xt){const B=pe(),oe=me(),C="https://hands-dedicated-bold-olympic.trycloudflare.com/api/v1",D=oe.params.id,v=m(null),b=m([]),E=m(0),R=m(1),S=m(!0),de=async()=>{const o=localStorage.getItem("auth_token");try{const{data:e}=await L(`${C}/decks/${D}`,{headers:{Authorization:`Bearer ${o}`}}).json();e.value&&(v.value=e.value)}catch{_.error("Failed to load deck")}},q=async()=>{S.value=!0;const o=localStorage.getItem("auth_token");try{const e=new URL(`${C}/decks/${D}/notes`);e.searchParams.append("page",R.value),e.searchParams.append("limit",20);const{data:l}=await L(e.toString(),{headers:{Authorization:`Bearer ${o}`}}).json();l.value&&(b.value=l.value.data,E.value=l.value.meta.total,R.value=l.value.meta.current_page)}catch{_.error("Failed to load cards")}finally{S.value=!1}},V=m(null),F=m(!1),z=m(!1),J=o=>{V.value=o,F.value=!0},ie=async()=>{if(!V.value)return;z.value=!0;const o=localStorage.getItem("auth_token"),e=V.value.id;try{await L(`${C}/notes/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),b.value=b.value.filter(l=>l.id!==e),E.value--,_.success("Note deleted")}catch{_.error("Failed to delete note")}finally{z.value=!1,F.value=!1,V.value=null}},Q=o=>{B.push(`/cards/${o}/edit`)},re=()=>{B.push(`/decks/${D}/add`)},h=m({title:"",description:""}),I=m(!1),P=m(!1),ue=async()=>{I.value=!0;const o=localStorage.getItem("auth_token");try{const{error:e}=await L(`${C}/decks/${D}`,{method:"PUT",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(h.value)}).json();if(e.value)throw new Error("Update failed");_.success("Deck updated"),v.value&&(v.value.title=h.value.title,v.value.description=h.value.description)}catch{_.error("Failed to update deck")}finally{I.value=!1}},H=m(!1),ce=async()=>{H.value=!0;const o=localStorage.getItem("auth_token");try{const{data:e}=await L(`${C}/decks/${D}/sync`,{method:"POST",headers:{Authorization:`Bearer ${o}`}}).json();e.value&&(_.success(e.value.message),q())}catch{_.error("Sync failed")}finally{H.value=!1}},fe=async()=>{if(!confirm("Are you absolutely sure? This will delete all cards in this deck."))return;P.value=!0;const o=localStorage.getItem("auth_token");try{const{error:e}=await L(`${C}/decks/${D}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}});if(e.value)throw new Error("Delete failed");_.success("Deck deleted"),B.push("/decks")}catch{_.error("Failed to delete deck"),P.value=!1}};_e(async()=>{await Promise.all([de(),q()])}),ve(v,o=>{o&&(h.value={title:o.title,description:o.description})},{immediate:!0});const M=o=>{if(!o.fields)return{label:"Front",content:"N/A"};const e=["pos","part of speech","id","audio","sound","image","picture","note","notes"],l=["expression","vocabulary","vocab","word","kanji","term","front","question","kana"],f=Object.keys(o.fields),c=f.reduce((r,j)=>(r[j.toLowerCase()]=j,r),{});for(const r of l)if(c[r])return{label:c[r],content:o.fields[c[r]]};for(const r of f)if(!e.includes(r.toLowerCase()))return{label:r,content:o.fields[r]};const p=f[0];return{label:p||"Front",content:o.fields[p]||"N/A"}},N=o=>{if(!o.fields)return{label:"Back",content:""};const e=["audio","sound","image","picture"],l=["meaning","definition","english","reading","back","answer","glossary"],f=Object.keys(o.fields),c=f.reduce((r,j)=>(r[j.toLowerCase()]=j,r),{});for(const r of l)if(c[r])return{label:c[r],content:o.fields[c[r]]};const p=f.filter(r=>!e.includes(r.toLowerCase()));return p.length>1?{label:p[1],content:o.fields[p[1]]}:{label:"Back",content:""}};return(o,e)=>(d(),u("div",Ke,[n("div",Re,[s(t(x),{variant:"ghost",class:"pl-0 gap-2 text-slate-500 hover:text-slate-900 dark:hover:text-slate-100",onClick:e[0]||(e[0]=l=>t(B).push("/decks"))},{default:a(()=>[s(t(he),{class:"w-4 h-4"}),e[5]||(e[5]=i(" Back to Decks ",-1))]),_:1}),v.value?(d(),u("div",qe,[n("div",null,[n("h1",Ze,k(v.value.title),1),n("p",Je,k(v.value.description),1)]),s(t(x),{class:"gap-2",onClick:re},{default:a(()=>[s(t(Te),{class:"w-4 h-4"}),e[6]||(e[6]=i(" Add Card ",-1))]),_:1})])):S.value?(d(),u("div",Qe,[s(t(y),{class:"h-10 w-1/3 mb-2"}),s(t(y),{class:"h-4 w-1/2"})])):w("",!0)]),s(t(we),{defaultValue:"cards",class:"w-full"},{default:a(()=>[s(t(be),{class:"mb-4"},{default:a(()=>[s(t(ee),{value:"cards",class:"gap-2"},{default:a(()=>[s(t(ke),{class:"w-4 h-4"}),e[7]||(e[7]=i(" Cards ",-1))]),_:1}),s(t(ee),{value:"settings",class:"gap-2"},{default:a(()=>[s(t(ye),{class:"w-4 h-4"}),e[8]||(e[8]=i(" Settings ",-1))]),_:1})]),_:1}),s(t(te),{value:"cards",class:"space-y-4"},{default:a(()=>[n("div",We,[S.value?(d(),u("div",Ge,[(d(),u(T,null,A(3,l=>s(t(y),{key:l,class:"h-32 w-full rounded-lg"})),64))])):b.value.length===0?(d(),u("div",Xe," No cards found. Start by adding one! ")):(d(!0),u(T,{key:2},A(b.value,l=>(d(),u("div",{key:l.id,class:"rounded-lg border bg-white dark:bg-slate-900 p-4 space-y-3 shadow-sm"},[n("div",Ye,[s(t(W),{variant:"secondary",class:"text-xs shrink-0"},{default:a(()=>[i(k(l.note_type?.name||l.type?.name||"Card"),1)]),_:2},1024),s(t(G),null,{default:a(()=>[s(t(X),{"as-child":""},{default:a(()=>[s(t(x),{variant:"ghost",class:"h-8 w-8 p-0 -mr-2 -mt-2 text-slate-400"},{default:a(()=>[e[9]||(e[9]=n("span",{class:"sr-only"},"Open menu",-1)),s(t(se),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(Y),{align:"end"},{default:a(()=>[s(t(U),{onClick:f=>Q(l.id)},{default:a(()=>[s(t(ae),{class:"mr-2 h-4 w-4"}),e[10]||(e[10]=i(" Edit ",-1))]),_:1},8,["onClick"]),s(t(U),{onClick:f=>J(l),class:"text-red-600 focus:text-red-600"},{default:a(()=>[s(t(le),{class:"mr-2 h-4 w-4"}),e[11]||(e[11]=i(" Delete ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("div",et,[M(l).content?(d(),u("div",tt,[n("div",st,k(M(l).label),1),n("div",{class:"font-medium text-lg leading-snug break-words",innerHTML:M(l).content},null,8,at)])):w("",!0),N(l).content?(d(),u("div",lt,[n("div",nt,k(N(l).label),1),n("div",{class:"text-slate-600 dark:text-slate-300 leading-snug break-words",innerHTML:N(l).content},null,8,ot)])):w("",!0)])]))),128))]),n("div",dt,[s(t($e),null,{default:a(()=>[s(t(Ce),null,{default:a(()=>[s(t(O),null,{default:a(()=>[s(t(K),{class:"w-[30%]"},{default:a(()=>[...e[12]||(e[12]=[i("Front",-1)])]),_:1}),s(t(K),{class:"w-[40%]"},{default:a(()=>[...e[13]||(e[13]=[i("Back",-1)])]),_:1}),s(t(K),null,{default:a(()=>[...e[14]||(e[14]=[i("Type",-1)])]),_:1}),s(t(K),{class:"text-right"},{default:a(()=>[...e[15]||(e[15]=[i("Actions",-1)])]),_:1})]),_:1})]),_:1}),s(t(De),null,{default:a(()=>[S.value?(d(),u(T,{key:0},A(5,l=>s(t(O),{key:l},{default:a(()=>[s(t(g),null,{default:a(()=>[s(t(y),{class:"h-4 w-20"})]),_:1}),s(t(g),null,{default:a(()=>[s(t(y),{class:"h-4 w-32"})]),_:1}),s(t(g),null,{default:a(()=>[s(t(y),{class:"h-4 w-16"})]),_:1}),s(t(g),null,{default:a(()=>[s(t(y),{class:"h-8 w-8 ml-auto"})]),_:1})]),_:1})),64)):b.value.length===0?(d(),$(t(O),{key:1},{default:a(()=>[s(t(g),{colspan:"4",class:"h-24 text-center"},{default:a(()=>[...e[16]||(e[16]=[i(" No cards found. Start by adding one! ",-1)])]),_:1})]),_:1})):(d(!0),u(T,{key:2},A(b.value,l=>(d(),$(t(O),{key:l.id},{default:a(()=>[s(t(g),{class:"font-medium truncate max-w-[300px]"},{default:a(()=>[n("span",it,k(M(l).label),1),n("span",{innerHTML:M(l).content},null,8,rt)]),_:2},1024),s(t(g),{class:"truncate max-w-[300px]"},{default:a(()=>[n("span",ut,k(N(l).label),1),n("span",{innerHTML:N(l).content},null,8,ct)]),_:2},1024),s(t(g),null,{default:a(()=>[s(t(W),{variant:"secondary",class:"text-xs"},{default:a(()=>[i(k(l.note_type?.name||l.type?.name||"Card"),1)]),_:2},1024)]),_:2},1024),s(t(g),{class:"text-right"},{default:a(()=>[s(t(G),null,{default:a(()=>[s(t(X),{"as-child":""},{default:a(()=>[s(t(x),{variant:"ghost",class:"h-8 w-8 p-0"},{default:a(()=>[e[17]||(e[17]=n("span",{class:"sr-only"},"Open menu",-1)),s(t(se),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(Y),{align:"end"},{default:a(()=>[s(t(U),{onClick:f=>Q(l.id)},{default:a(()=>[s(t(ae),{class:"mr-2 h-4 w-4"}),e[18]||(e[18]=i(" Edit ",-1))]),_:1},8,["onClick"]),s(t(U),{onClick:f=>J(l),class:"text-red-600 focus:text-red-600"},{default:a(()=>[s(t(le),{class:"mr-2 h-4 w-4"}),e[19]||(e[19]=i(" Delete ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),E.value>20?(d(),u("div",ft,[s(t(Le),{total:E.value,"sibling-count":1,"show-edges":"","default-page":1,"items-per-page":20,"onUpdate:page":e[1]||(e[1]=l=>{R.value=l,q()})},{default:a(({page:l})=>[s(t(Se),{class:"flex items-center gap-1 justify-center"},{default:a(({items:f})=>[s(t(Me)),s(t(Ne)),(d(!0),u(T,null,A(f,(c,p)=>(d(),u(T,null,[c.type==="page"?(d(),$(t(je),{key:p,value:c.value,"as-child":""},{default:a(()=>[s(t(x),{class:"w-9 h-9 p-0",variant:c.value===l?"default":"outline"},{default:a(()=>[i(k(c.value),1)]),_:2},1032,["variant"])]),_:2},1032,["value"])):(d(),$(t(Ae),{key:c.type,index:p},null,8,["index"]))],64))),256)),s(t(Be)),s(t(Ee))]),_:2},1024)]),_:1},8,["total"])])):w("",!0)]),_:1}),s(t(te),{value:"settings"},{default:a(()=>[n("div",mt,[e[29]||(e[29]=n("div",null,[n("h3",{class:"text-lg font-medium"},"Deck Settings"),n("p",{class:"text-sm text-slate-500"},"Manage your deck's preferences.")],-1)),v.value?(d(),u("div",_t,[n("div",vt,[e[20]||(e[20]=n("label",{class:"text-sm font-medium"},"Deck Title",-1)),s(t(ge),{modelValue:h.value.title,"onUpdate:modelValue":e[2]||(e[2]=l=>h.value.title=l)},null,8,["modelValue"])]),n("div",pt,[e[21]||(e[21]=n("label",{class:"text-sm font-medium"},"Description",-1)),s(t(xe),{modelValue:h.value.description,"onUpdate:modelValue":e[3]||(e[3]=l=>h.value.description=l),class:"resize-none h-32"},null,8,["modelValue"])]),s(t(x),{onClick:ue,disabled:I.value},{default:a(()=>[I.value?(d(),$(t(Z),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),e[22]||(e[22]=i(" Save Changes ",-1))]),_:1},8,["disabled"])])):(d(),u("div",kt,[s(t(y),{class:"h-10 w-full"}),s(t(y),{class:"h-32 w-full"})])),n("div",yt,[e[25]||(e[25]=n("h3",{class:"text-lg font-medium"},"Maintenance",-1)),n("div",gt,[e[24]||(e[24]=n("div",null,[n("div",{class:"font-medium text-slate-900 dark:text-slate-100"},"Sync Cards"),n("div",{class:"text-sm text-slate-500"},"Fix missing cards if deck seems empty but has notes.")],-1)),s(t(x),{variant:"outline",onClick:ce,disabled:H.value},{default:a(()=>[H.value?(d(),$(t(Z),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),e[23]||(e[23]=i(" Repair & Sync ",-1))]),_:1},8,["disabled"])])]),n("div",ht,[e[27]||(e[27]=n("h3",{class:"text-lg font-medium text-red-600"},"Danger Zone",-1)),e[28]||(e[28]=n("p",{class:"text-sm text-slate-500 mb-4"},"Once you delete a deck, there is no going back.",-1)),s(t(x),{variant:"destructive",onClick:fe,disabled:P.value},{default:a(()=>[P.value?(d(),$(t(Z),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),e[26]||(e[26]=i(" Delete Deck ",-1))]),_:1},8,["disabled"])])])]),_:1})]),_:1}),s(t(Oe),{open:F.value,"onUpdate:open":e[4]||(e[4]=l=>F.value=l)},{default:a(()=>[s(t(Ve),null,{default:a(()=>[s(t(Fe),null,{default:a(()=>[s(t(ze),null,{default:a(()=>[...e[30]||(e[30]=[i("Delete this card?",-1)])]),_:1}),s(t(Ie),null,{default:a(()=>[...e[31]||(e[31]=[i(" This will permanently remove this note and its associated cards from the deck. ",-1)])]),_:1})]),_:1}),s(t(Pe),null,{default:a(()=>[s(t(He),{disabled:z.value},{default:a(()=>[...e[32]||(e[32]=[i("Cancel",-1)])]),_:1},8,["disabled"]),s(t(Ue),{onClick:ie,disabled:z.value,class:"bg-red-600 hover:bg-red-700 focus:ring-red-600 text-white"},{default:a(()=>[...e[33]||(e[33]=[i(" Delete ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}};export{Tt as default};
