import{c as J,s as me,r as m,o as ve,P as _e,d as u,e as n,f as s,n as w,w as a,h as d,u as t,i as pe,j as x,t as k,_ as y,a2 as ke,Q as M,R as A,l as G,U as W,V as X,Y as ee,Z as U,g as $,k as ye,a1 as Z,v as T,x as v,z as i}from"./index-DhmeCW2F.js";import{A as ge,_ as he}from"./Textarea-CIRzcv_j.js";import{_ as xe,a as te,b as se,c as be}from"./TabsTrigger-BX_RvZC-.js";import{_ as we,a as $e,b as O,c as K,d as Ce,e as g}from"./TableHeader-D9szp-BW.js";import{P as De,E as ae,h as Me,_ as Te,b as Le,c as Se,d as je,e as Ne,f as Ae,g as Be,i as Ve,j as Ee,k as ze,l as Fe,m as He,n as Pe,o as Ie,p as Ue}from"./AlertDialogTitle-BR1WYSfo.js";const Oe=J("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const le=J("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const ne=J("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),Ke={class:"max-w-7xl mx-auto space-y-6"},Re={class:"space-y-4"},qe={key:0,class:"flex justify-between items-start"},Ze={class:"text-3xl font-bold tracking-tight text-slate-900 dark:text-slate-50"},Je={class:"text-slate-500 dark:text-slate-400 mt-1 max-w-3xl"},Qe={key:1},Ye={class:"space-y-4 md:hidden"},Ge={key:0,class:"space-y-4"},We={key:1,class:"text-center py-12 text-slate-500 border-2 border-dashed rounded-lg"},Xe={class:"flex justify-between items-start"},et={class:"grid gap-2"},tt={key:0},st={class:"text-xs text-slate-500 uppercase tracking-wider font-semibold mb-1"},at=["innerHTML"],lt={key:1,class:"border-t pt-2 mt-1"},nt={class:"text-xs text-slate-500 uppercase tracking-wider font-semibold mb-1"},ot=["innerHTML"],it={class:"hidden md:block rounded-md border bg-white dark:bg-slate-900"},dt={class:"text-xs text-slate-400 block mb-0.5"},rt=["innerHTML"],ut={class:"text-xs text-slate-400 block mb-0.5"},ct=["innerHTML"],ft={key:0,class:"py-4"},mt={class:"rounded-lg border bg-white dark:bg-slate-900 p-6 space-y-6"},vt={key:0,class:"grid gap-4 max-w-sm"},_t={class:"space-y-2"},pt={class:"space-y-2"},kt={key:1,class:"space-y-4 max-w-sm"},yt={class:"pt-6 border-t space-y-4"},gt={class:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-lg"},ht={class:"pt-6 border-t"},Mt={__name:"DeckDetailView",setup(xt){const B=pe(),oe=me(),C="https://activities-associates-involving-soul.trycloudflare.com/api/v1",D=oe.params.id,_=m(null),b=m([]),V=m(0),R=m(1),L=m(!0),ie=async()=>{const o=localStorage.getItem("auth_token");try{const{data:e}=await T(`${C}/decks/${D}`,{headers:{Authorization:`Bearer ${o}`}}).json();e.value&&(_.value=e.value)}catch{v.error("Failed to load deck")}},q=async()=>{L.value=!0;const o=localStorage.getItem("auth_token");try{const e=new URL(`${C}/decks/${D}/notes`);e.searchParams.append("page",R.value),e.searchParams.append("limit",20);const{data:l}=await T(e.toString(),{headers:{Authorization:`Bearer ${o}`}}).json();l.value&&(b.value=l.value.data,V.value=l.value.meta.total,R.value=l.value.meta.current_page)}catch{v.error("Failed to load cards")}finally{L.value=!1}},E=m(null),z=m(!1),F=m(!1),Q=o=>{E.value=o,z.value=!0},de=async()=>{if(!E.value)return;F.value=!0;const o=localStorage.getItem("auth_token"),e=E.value.id;try{await T(`${C}/notes/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),b.value=b.value.filter(l=>l.id!==e),V.value--,v.success("Note deleted")}catch{v.error("Failed to delete note")}finally{F.value=!1,z.value=!1,E.value=null}},Y=o=>{B.push(`/cards/${o}/edit`)},re=()=>{B.push(`/decks/${D}/add`)},h=m({title:"",description:""}),H=m(!1),P=m(!1),ue=async()=>{H.value=!0;const o=localStorage.getItem("auth_token");try{const{error:e}=await T(`${C}/decks/${D}`,{method:"PUT",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(h.value)}).json();if(e.value)throw new Error("Update failed");v.success("Deck updated"),_.value&&(_.value.title=h.value.title,_.value.description=h.value.description)}catch{v.error("Failed to update deck")}finally{H.value=!1}},I=m(!1),ce=async()=>{I.value=!0;const o=localStorage.getItem("auth_token");try{const{data:e}=await T(`${C}/decks/${D}/sync`,{method:"POST",headers:{Authorization:`Bearer ${o}`}}).json();e.value&&(v.success(e.value.message),q())}catch{v.error("Sync failed")}finally{I.value=!1}},fe=async()=>{if(!confirm("Are you absolutely sure? This will delete all cards in this deck."))return;P.value=!0;const o=localStorage.getItem("auth_token");try{const{error:e}=await T(`${C}/decks/${D}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}});if(e.value)throw new Error("Delete failed");v.success("Deck deleted"),B.push("/decks")}catch{v.error("Failed to delete deck"),P.value=!1}};ve(async()=>{await Promise.all([ie(),q()])}),_e(_,o=>{o&&(h.value={title:o.title,description:o.description})},{immediate:!0});const S=o=>{if(!o.fields)return{label:"Front",content:"N/A"};const e=["pos","part of speech","id","audio","sound","image","picture","note","notes"],l=["expression","vocabulary","vocab","word","kanji","term","front","question","kana"],f=Object.keys(o.fields),c=f.reduce((r,N)=>(r[N.toLowerCase()]=N,r),{});for(const r of l)if(c[r])return{label:c[r],content:o.fields[c[r]]};for(const r of f)if(!e.includes(r.toLowerCase()))return{label:r,content:o.fields[r]};const p=f[0];return{label:p||"Front",content:o.fields[p]||"N/A"}},j=o=>{if(!o.fields)return{label:"Back",content:""};const e=["audio","sound","image","picture"],l=["meaning","definition","english","reading","back","answer","glossary"],f=Object.keys(o.fields),c=f.reduce((r,N)=>(r[N.toLowerCase()]=N,r),{});for(const r of l)if(c[r])return{label:c[r],content:o.fields[c[r]]};const p=f.filter(r=>!e.includes(r.toLowerCase()));return p.length>1?{label:p[1],content:o.fields[p[1]]}:{label:"Back",content:""}};return(o,e)=>(i(),u("div",Ke,[n("div",Re,[s(t(x),{variant:"ghost",class:"pl-0 gap-2 text-slate-500 hover:text-slate-900 dark:hover:text-slate-100",onClick:e[0]||(e[0]=l=>t(B).push("/decks"))},{default:a(()=>[s(t(ge),{class:"w-4 h-4"}),e[5]||(e[5]=d(" Back to Decks ",-1))]),_:1}),_.value?(i(),u("div",qe,[n("div",null,[n("h1",Ze,k(_.value.title),1),n("p",Je,k(_.value.description),1)]),s(t(x),{class:"gap-2",onClick:re},{default:a(()=>[s(t(De),{class:"w-4 h-4"}),e[6]||(e[6]=d(" Add Card ",-1))]),_:1})])):L.value?(i(),u("div",Qe,[s(t(y),{class:"h-10 w-1/3 mb-2"}),s(t(y),{class:"h-4 w-1/2"})])):w("",!0)]),s(t(be),{defaultValue:"cards",class:"w-full"},{default:a(()=>[s(t(xe),{class:"mb-4"},{default:a(()=>[s(t(te),{value:"cards",class:"gap-2"},{default:a(()=>[s(t(Oe),{class:"w-4 h-4"}),e[7]||(e[7]=d(" Cards ",-1))]),_:1}),s(t(te),{value:"settings",class:"gap-2"},{default:a(()=>[s(t(ke),{class:"w-4 h-4"}),e[8]||(e[8]=d(" Settings ",-1))]),_:1})]),_:1}),s(t(se),{value:"cards",class:"space-y-4"},{default:a(()=>[n("div",Ye,[L.value?(i(),u("div",Ge,[(i(),u(M,null,A(3,l=>s(t(y),{key:l,class:"h-32 w-full rounded-lg"})),64))])):b.value.length===0?(i(),u("div",We," No cards found. Start by adding one! ")):(i(!0),u(M,{key:2},A(b.value,l=>(i(),u("div",{key:l.id,class:"rounded-lg border bg-white dark:bg-slate-900 p-4 space-y-3 shadow-sm"},[n("div",Xe,[s(t(G),{variant:"secondary",class:"text-xs shrink-0"},{default:a(()=>[d(k(l.note_type?.name||l.type?.name||"Card"),1)]),_:2},1024),s(t(W),null,{default:a(()=>[s(t(X),{"as-child":""},{default:a(()=>[s(t(x),{variant:"ghost",class:"h-8 w-8 p-0 -mr-2 -mt-2 text-slate-400"},{default:a(()=>[e[9]||(e[9]=n("span",{class:"sr-only"},"Open menu",-1)),s(t(ae),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ee),{align:"end"},{default:a(()=>[s(t(U),{onClick:f=>Y(l.id)},{default:a(()=>[s(t(le),{class:"mr-2 h-4 w-4"}),e[10]||(e[10]=d(" Edit ",-1))]),_:1},8,["onClick"]),s(t(U),{onClick:f=>Q(l),class:"text-red-600 focus:text-red-600"},{default:a(()=>[s(t(ne),{class:"mr-2 h-4 w-4"}),e[11]||(e[11]=d(" Delete ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),n("div",et,[S(l).content?(i(),u("div",tt,[n("div",st,k(S(l).label),1),n("div",{class:"font-medium text-lg leading-snug break-words",innerHTML:S(l).content},null,8,at)])):w("",!0),j(l).content?(i(),u("div",lt,[n("div",nt,k(j(l).label),1),n("div",{class:"text-slate-600 dark:text-slate-300 leading-snug break-words",innerHTML:j(l).content},null,8,ot)])):w("",!0)])]))),128))]),n("div",it,[s(t(we),null,{default:a(()=>[s(t($e),null,{default:a(()=>[s(t(O),null,{default:a(()=>[s(t(K),{class:"w-[30%]"},{default:a(()=>[...e[12]||(e[12]=[d("Front",-1)])]),_:1}),s(t(K),{class:"w-[40%]"},{default:a(()=>[...e[13]||(e[13]=[d("Back",-1)])]),_:1}),s(t(K),null,{default:a(()=>[...e[14]||(e[14]=[d("Type",-1)])]),_:1}),s(t(K),{class:"text-right"},{default:a(()=>[...e[15]||(e[15]=[d("Actions",-1)])]),_:1})]),_:1})]),_:1}),s(t(Ce),null,{default:a(()=>[L.value?(i(),u(M,{key:0},A(5,l=>s(t(O),{key:l},{default:a(()=>[s(t(g),null,{default:a(()=>[s(t(y),{class:"h-4 w-20"})]),_:1}),s(t(g),null,{default:a(()=>[s(t(y),{class:"h-4 w-32"})]),_:1}),s(t(g),null,{default:a(()=>[s(t(y),{class:"h-4 w-16"})]),_:1}),s(t(g),null,{default:a(()=>[s(t(y),{class:"h-8 w-8 ml-auto"})]),_:1})]),_:1})),64)):b.value.length===0?(i(),$(t(O),{key:1},{default:a(()=>[s(t(g),{colspan:"4",class:"h-24 text-center"},{default:a(()=>[...e[16]||(e[16]=[d(" No cards found. Start by adding one! ",-1)])]),_:1})]),_:1})):(i(!0),u(M,{key:2},A(b.value,l=>(i(),$(t(O),{key:l.id},{default:a(()=>[s(t(g),{class:"font-medium truncate max-w-[300px]"},{default:a(()=>[n("span",dt,k(S(l).label),1),n("span",{innerHTML:S(l).content},null,8,rt)]),_:2},1024),s(t(g),{class:"truncate max-w-[300px]"},{default:a(()=>[n("span",ut,k(j(l).label),1),n("span",{innerHTML:j(l).content},null,8,ct)]),_:2},1024),s(t(g),null,{default:a(()=>[s(t(G),{variant:"secondary",class:"text-xs"},{default:a(()=>[d(k(l.note_type?.name||l.type?.name||"Card"),1)]),_:2},1024)]),_:2},1024),s(t(g),{class:"text-right"},{default:a(()=>[s(t(W),null,{default:a(()=>[s(t(X),{"as-child":""},{default:a(()=>[s(t(x),{variant:"ghost",class:"h-8 w-8 p-0"},{default:a(()=>[e[17]||(e[17]=n("span",{class:"sr-only"},"Open menu",-1)),s(t(ae),{class:"h-4 w-4"})]),_:1})]),_:1}),s(t(ee),{align:"end"},{default:a(()=>[s(t(U),{onClick:f=>Y(l.id)},{default:a(()=>[s(t(le),{class:"mr-2 h-4 w-4"}),e[18]||(e[18]=d(" Edit ",-1))]),_:1},8,["onClick"]),s(t(U),{onClick:f=>Q(l),class:"text-red-600 focus:text-red-600"},{default:a(()=>[s(t(ne),{class:"mr-2 h-4 w-4"}),e[19]||(e[19]=d(" Delete ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),V.value>20?(i(),u("div",ft,[s(t(Me),{total:V.value,"sibling-count":1,"show-edges":"","default-page":1,"items-per-page":20,"onUpdate:page":e[1]||(e[1]=l=>{R.value=l,q()})},{default:a(({page:l})=>[s(t(Te),{class:"flex items-center gap-1 justify-center"},{default:a(({items:f})=>[s(t(Le)),s(t(Se)),(i(!0),u(M,null,A(f,(c,p)=>(i(),u(M,null,[c.type==="page"?(i(),$(t(je),{key:p,value:c.value,"as-child":""},{default:a(()=>[s(t(x),{class:"w-9 h-9 p-0",variant:c.value===l?"default":"outline"},{default:a(()=>[d(k(c.value),1)]),_:2},1032,["variant"])]),_:2},1032,["value"])):(i(),$(t(Ne),{key:c.type,index:p},null,8,["index"]))],64))),256)),s(t(Ae)),s(t(Be))]),_:2},1024)]),_:1},8,["total"])])):w("",!0)]),_:1}),s(t(se),{value:"settings"},{default:a(()=>[n("div",mt,[e[29]||(e[29]=n("div",null,[n("h3",{class:"text-lg font-medium"},"Deck Settings"),n("p",{class:"text-sm text-slate-500"},"Manage your deck's preferences.")],-1)),_.value?(i(),u("div",vt,[n("div",_t,[e[20]||(e[20]=n("label",{class:"text-sm font-medium"},"Deck Title",-1)),s(t(ye),{modelValue:h.value.title,"onUpdate:modelValue":e[2]||(e[2]=l=>h.value.title=l)},null,8,["modelValue"])]),n("div",pt,[e[21]||(e[21]=n("label",{class:"text-sm font-medium"},"Description",-1)),s(t(he),{modelValue:h.value.description,"onUpdate:modelValue":e[3]||(e[3]=l=>h.value.description=l),class:"resize-none h-32"},null,8,["modelValue"])]),s(t(x),{onClick:ue,disabled:H.value},{default:a(()=>[H.value?(i(),$(t(Z),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),e[22]||(e[22]=d(" Save Changes ",-1))]),_:1},8,["disabled"])])):(i(),u("div",kt,[s(t(y),{class:"h-10 w-full"}),s(t(y),{class:"h-32 w-full"})])),n("div",yt,[e[25]||(e[25]=n("h3",{class:"text-lg font-medium"},"Maintenance",-1)),n("div",gt,[e[24]||(e[24]=n("div",null,[n("div",{class:"font-medium text-slate-900 dark:text-slate-100"},"Sync Cards"),n("div",{class:"text-sm text-slate-500"},"Fix missing cards if deck seems empty but has notes.")],-1)),s(t(x),{variant:"outline",onClick:ce,disabled:I.value},{default:a(()=>[I.value?(i(),$(t(Z),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),e[23]||(e[23]=d(" Repair & Sync ",-1))]),_:1},8,["disabled"])])]),n("div",ht,[e[27]||(e[27]=n("h3",{class:"text-lg font-medium text-red-600"},"Danger Zone",-1)),e[28]||(e[28]=n("p",{class:"text-sm text-slate-500 mb-4"},"Once you delete a deck, there is no going back.",-1)),s(t(x),{variant:"destructive",onClick:fe,disabled:P.value},{default:a(()=>[P.value?(i(),$(t(Z),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):w("",!0),e[26]||(e[26]=d(" Delete Deck ",-1))]),_:1},8,["disabled"])])])]),_:1})]),_:1}),s(t(Ue),{open:z.value,"onUpdate:open":e[4]||(e[4]=l=>z.value=l)},{default:a(()=>[s(t(Ve),null,{default:a(()=>[s(t(Ee),null,{default:a(()=>[s(t(ze),null,{default:a(()=>[...e[30]||(e[30]=[d("Delete this card?",-1)])]),_:1}),s(t(Fe),null,{default:a(()=>[...e[31]||(e[31]=[d(" This will permanently remove this note and its associated cards from the deck. ",-1)])]),_:1})]),_:1}),s(t(He),null,{default:a(()=>[s(t(Pe),{disabled:F.value},{default:a(()=>[...e[32]||(e[32]=[d("Cancel",-1)])]),_:1},8,["disabled"]),s(t(Ie),{onClick:de,disabled:F.value,class:"bg-red-600 hover:bg-red-700 focus:ring-red-600 text-white"},{default:a(()=>[...e[33]||(e[33]=[d(" Delete ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]))}};export{Mt as default};
